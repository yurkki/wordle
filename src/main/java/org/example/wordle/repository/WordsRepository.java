package org.example.wordle.repository;

import lombok.Getter;
import org.springframework.stereotype.Repository;

import java.util.Arrays;
import java.util.List;
import java.util.Set;

/**
 * Репозиторий для работы со словами
 */
@Repository
public class WordsRepository {

    @Getter
    private final List<String> allWords;

    @Getter
    private final List<String> fiveLetterWords;
    private final Set<String> validWords;

    public WordsRepository() {
        this.allWords = Arrays.asList(
                "АБЗАЦ", "АВТОР", "АГЕНТ", "АДРЕС", "АЗАРТ", "АЗИАТ", "АКТИВ", "АЛМАЗ", "АМПЕР", "АНГАР", "АРБУЗ", "АРЕНА",
                "АРХИВ", "АТЛАС", "АКТЁР", "АМЁБА", "АФЁРА", "АКЦИЯ", "АЛЛЕЯ", "АРМИЯ",
                "БАГАЖ", "БАЗАР", "БАЙКА", "БАЛЕТ", "БАНАН", "БАРЖА", "БАСНЯ", "БАТОН", "БЕГУН", "БЕЛКА", "БИЛЕТ", "БУКВА",
                "БЕРЕГ", "БИЛЕТ", "БИРЖА", "БОКАЛ", "БОМБА", "БРАВО", "БРАГА", "БРАНЬ", "БРАСС", "БРЕМЯ", "БРЕНД", "БРЕШЬ",
                "ВАГОН", "ВАЗОН", "ВАЛЕТ", "ВАЛЬС", "ВАННА", "ВЕСНА", "ВЕТКА", "ВИДЕО", "ВИЛКА",
                "ВОЛНА", "ВОРОТ", "ВЫБОР", "ВОПЁЖ", "ВАФЛЯ",
                "ГАЗОН", "ГАММА", "ГАРАЖ", "ГЕРОЙ", "ГОЛОС", "ГОРКА", "ГРУША", "ГУСАК", "ГЛАЗА", "ГЛЯСЕ", "ГОЛЯК", "ГОРОД",
                "ДАВКА", "ДЕБЕТ", "ДЕТКА", "ДИВАН", "ДОБРО", "ДОСКА", "ДОЧКА", "ДУБОК", "ДОМЁК", "ДВОЯК", "ДРОВА", "ДУБЛЬ",
                "ДОМЕН", "ДРАЙВ",
                "ЕПАРХ", "ЕРЕСЬ",
                "ЖАТВА", "ЖИВОТ", "ЖИЛЕТ",
                "ЗАБОР", "ЗАВОД", "ЗАГАР", "ЗАКАЗ", "ЗАМОК", "ЗАПАД", "ЗЕБРА", "ЗЕМЛЯ", "ЗАЛЁТ", "ЗАВЕЯ", "ЗАРЯД", "ЗАТЕЯ",
                "ИДЕАЛ", "ИКОНА", "ИСТОК",
                "КАБАН", "КАЗАК", "КАНАЛ", "КАПЛЯ", "КАРТА", "КАТОК", "КЛАСС", "КНИГА", "КОЛОС", "КОНЕЦ", "КОПИЯ", "КРЕСТ",
                "КРОВЬ", "КУКЛА", "КОВЁР", "КОЗЁЛ", "КОПЬЁ", "КОТЁЛ", "КУЛЁК", "КУТЁЖ", "КНИГА", "КИСТЬ",
                "ЛАВКА", "ЛАМПА", "ЛИМОН", "ЛОЖКА", "ЛАРЁК", "ЛИКЁР", "ЛИТЬЁ", "ЛАДЬЯ", "ЛАЗНЯ", "ЛЕПНЯ", "ЛИЛИЯ", "ЛЫЖНЯ",
                "МАСЛО", "МЕСТО", "МЕТРО", "МАСКА", "МАГИЯ", "МЫСЛЬ",
                "НАРОД", "НЕФТЬ", "НУЖДА", "НИТКА", "НАУКА",
                "ОГОНЬ", "ОЗЕРО", "ОБУВЬ",
                "ПАРТА", "ПЕСОК", "ПТИЦА", "ПОЕЗД", "ПАПКА", "ПОЧТА",
                "РОЛИК", "РЫБАК", "РУЧЕЙ", "РУЧКА", "РАМКА", "РИФМА",
                "СЦЕНА", "СТЕПЬ", "САХАР", "СЕДЛО", "САПОГ", "СЮЖЕТ", "СКРИП",
                "ТАБЛО", "ТАНЕЦ", "ТКАНЬ", "ТЕКСТ",
                "УСПЕХ",
                "ФИЛЬМ",
                "ХАРЕК", "ХИМИЯ",
                "ЦЕНТР",
                "ЧАЙКА", "ЧИСЛО",
                "ЖИЗНЬ", "ИГРОК",
                "ЖИЗНЬ", "ИГРОК",
                "ШАПКА", "ШКОЛА", "ШРИФТ",
                "ЭКРАН"
                );

        // Фильтруем только 5-буквенные слова один раз при инициализации
        this.fiveLetterWords = allWords.stream()
                .filter(word -> word.length() == 5)
                .toList();

        // Создаем Set для быстрой проверки валидности слов (нормализованные)
        this.validWords = fiveLetterWords.stream()
                .map(this::normalizeWord)
                .collect(java.util.stream.Collectors.toSet());
    }

    /**
     * Проверить, является ли слово загадываемым словом (есть в списке)
     */
    public boolean isTargetWord(String word) {
        return word != null && validWords.contains(normalizeWord(word));
    }
    
    /**
     * Нормализует слово, заменяя ё на е для унификации
     */
    private String normalizeWord(String word) {
        return word.toUpperCase()
                .replace('Ё', 'Е')
                .replace('ё', 'Е');
    }

    /**
     * Получить случайное 5-буквенное слово
     */
    public String getRandomFiveLetterWord() {
        if (fiveLetterWords.isEmpty()) {
            throw new IllegalStateException("Нет доступных 5-буквенных слов");
        }
        return fiveLetterWords.get((int) (Math.random() * fiveLetterWords.size()));
    }
}
